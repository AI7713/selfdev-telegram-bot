import os
import logging
import random
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import Application, CommandHandler, MessageHandler, filters, CallbackContext

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

TOKEN = os.getenv('TELEGRAM_TOKEN')

# –ö–û–ù–°–¢–ê–ù–¢–´ –î–õ–Ø –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê –≠–ö–û–ù–û–ú–ò–ö–ò
CALCULATOR_STEPS = [
    "üí∞ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞ (—Ä—É–±):",
    "üè∑Ô∏è –ü—Ä–æ–¥–∞–∂–Ω–∞—è —Ü–µ–Ω–∞ (—Ä—É–±):", 
    "üìä –ö–æ–º–∏—Å—Å–∏—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ (%):",
    "üöö –õ–æ–≥–∏—Å—Ç–∏–∫–∞ FBS (% –æ—Ç —Ü–µ–Ω—ã):",
    "üì¢ –ë—é–¥–∂–µ—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É, ACOS (%):",
    "üí∏ –ù–∞–ª–æ–≥ –£–°–ù (%):"
]

BENCHMARKS = {
    '–Ω–∞—Ü–µ–Ω–∫–∞': {'–Ω–∏–∑–∫–∞—è': 100, '—Å—Ä–µ–¥–Ω—è—è': 200, '–≤—ã—Å–æ–∫–∞—è': 300},
    '–∫–æ–º–∏—Å—Å–∏—è_mp': {'–Ω–∏–∑–∫–∞—è': 10, '—Å—Ä–µ–¥–Ω—è—è': 15, '–≤—ã—Å–æ–∫–∞—è': 20},
    '–ª–æ–≥–∏—Å—Ç–∏–∫–∞': {'–Ω–∏–∑–∫–∞—è': 10, '—Å—Ä–µ–¥–Ω—è—è': 15, '–≤—ã—Å–æ–∫–∞—è': 20},
    'acos': {'–Ω–∏–∑–∫–∏–π': 5, '—Å—Ä–µ–¥–Ω–∏–π': 10, '–≤—ã—Å–æ–∫–∏–π': 15},
    '—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞': {'–Ω–∏–∑–∫–∞—è': 20, '—Å—Ä–µ–¥–Ω—è—è': 30, '–≤—ã—Å–æ–∫–∞—è': 40}
}

# –ó–ê–©–ò–©–ï–ù–ù–´–ï –¥–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–∏ –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–º—Ç–æ–≤
DEMO_SCENARIOS = {
    '–≥—Ä–∏–º—É–∞—Ä': {
        '–∞—Ä—Ö–µ—Ç–∏–ø—ã': 'üîÆ –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.',
        '–º–µ—Ç–∞—Ñ–æ—Ä—ã': 'üåå –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª—É–±–æ–∫—É—é —Ä–∞–±–æ—Ç—É —Å –æ–±—Ä–∞–∑–∞–º–∏ –∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π.',
        '—Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ': 'üß† –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.'
    },
    '–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫': {
        '–∫–æ–Ω—Ñ–ª–∏–∫—Ç': '‚ö° –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ –¥–∏–∞–ª–æ–≥–∞–º–∏, –≤–∫–ª—é—á–∞—è —Ç–µ—Ö–Ω–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–º–æ—Ü–∏—è–º–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ—Å–µ–¥—ã.',
        '–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞': 'üìã –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ, –≤–∫–ª—é—á–∞—è –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.',
        '–≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è': 'üõ°Ô∏è –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –æ—Å–≤–æ–∏—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ä–∞–±–æ—Ç–µ —Å —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ–º –∏ –Ω–∞—É—á–∏—Ç–µ—Å—å –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è –≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.'
    },
    '–ø—Ä–æ–µ–∫—Ç—ã': {
        '—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞': 'üöÄ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–∫–ª—é—á–∞–µ—Ç —É–≥–ª—É–±–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –∏–¥–µ–µ–π —Å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ–º —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.',
        '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ': 'üìä –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–æ–ª–µ–π, —Å—Ä–æ–∫–æ–≤ –∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ —É—Å–ø–µ—Ö–∞.',
        '–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ': '‚ö° –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –ø–æ—à–∞–≥–æ–≤–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ.'
    },
    '–∫–∞—Ä—Ç–∞ –ª–∏—á–Ω–æ—Å—Ç–∏': {
        '–ø—Ä–æ—Ñ–∏–ª—å': 'üß† –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤–∞—à–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π —Å —É—á–µ—Ç–æ–º –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤.',
        '—Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã': 'üí™ –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–º–æ–≥–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.',
        '—Å—Ü–µ–Ω–∞—Ä–∏–∏': 'üìà –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ—Ä–æ–∂–Ω—ã–µ –∫–∞—Ä—Ç—ã —Ä–∞–∑–≤–∏—Ç–∏—è —Å —É—á–µ—Ç–æ–º –≤–∞—à–∏—Ö —Ü–µ–ª–µ–π –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.'
    },
    '—Å—Ç—Ä–∞—Ç–µ–≥–∏—è': {
        '–∞–Ω–∞–ª–∏–∑': 'üìà –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–º—ã —Å —É—á–µ—Ç–æ–º –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤ —Ä–∞–∑–≤–∏—Ç–∏—è.',
        '–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ': 'üéØ –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —à–∞–≥–æ–≤ –∏ —Ç–∞–∫—Ç–∏–∫ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.',
        '–ø—Ä–æ–≥–Ω–æ–∑': 'üîÆ –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Å—Ü–µ–Ω–∞—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ—Ü–µ–Ω–∫–æ–π —Ä–∏—Å–∫–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.'
    },
    '–¥–∞–π–¥–∂–µ—Å—Ç': {
        '–æ–±–∑–æ—Ä': 'üåç –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–∑–æ—Ä—ã –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –∏ —Å–æ–±—ã—Ç–∏–π —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º.',
        '–ø—Ä–æ–≥–Ω–æ–∑—ã': 'üìä –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑—ã —Ä–∞–∑–≤–∏—Ç–∏—è —Å–∏—Ç—É–∞—Ü–∏–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –∏ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –≤–ª–∏—è–Ω–∏—è.',
        '—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏': 'üí° –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —É—á–∏—Ç—ã–≤–∞—é—â–∏–µ –≤–∞—à—É —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –∏ —Ü–µ–ª–∏.'
    },
    '–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å': {
        '—ç–∫–æ–Ω–æ–º–∏–∫–∞': 'üõí –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å —É—á–µ—Ç–æ–º —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.',
        '–∫–∞—Ä—Ç–æ—á–∫–∞': 'üìã –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —É—á–µ—Ç–æ–º –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤.',
        '–ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ': 'üöÄ –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è –∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∞—É–¥–∏—Ç–æ—Ä–∏–∏.'
    },
    '–∞–Ω–∞–ª–∏–∑ –∏—Ç–æ–≥–æ–≤': {
        '–ø—Ä–∏—á–∏–Ω—ã': 'üîç –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–∫–ª—é—á–∞–µ—Ç –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –ø–æ–≤–ª–∏—è–≤—à–∏—Ö –Ω–∞ –∏—Å—Ö–æ–¥.',
        '–¥–∞–Ω–Ω—ã–µ': 'üìä –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –≤ –≤–∞—à–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.',
        '–æ–±—Ä–∞—Ç–Ω—ã–π –ø–ª–∞–Ω': 'üîÑ –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ —É—Å–ø–µ—à–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.'
    },
    '–∫–æ–º–ø–∞—Å —Ç–µ–º': {
        '–º–æ—Ç–∏–≤—ã': 'üß≠ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–∫–ª—é—á–∞–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≥–ª—É–±–∏–Ω–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ —Ç–µ–º–µ –∏ –∏—Ö —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Å —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏.',
        '–∏—Å—Ö–æ–¥': 'üéØ –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–º–æ–≥–∞–µ—Ç —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ—Ä–∏–º—ã–µ —Ü–µ–ª–∏ –∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∂–µ–ª–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.',
        '—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç': '‚ö° –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã —Å–æ–∑–¥–∞–µ—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.'
    },
    '–º–∞–∫—Ä–æ-–∞–Ω–∞–ª–∏–∑': {
        '–º–µ—Ç—Ä–∏–∫–∏': 'üìä –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–∫–ª—é—á–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–µ–π –∏—Ö –¥–∏–Ω–∞–º–∏–∫–∏.',
        '—Å—Ü–µ–Ω–∞—Ä–∏–∏': 'üåê –ü–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞–∑–≤–∏—Ç–∏—è —Å —É—á–µ—Ç–æ–º –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.',
        '–¥–µ–π—Å—Ç–≤–∏—è': 'üí° –í –ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–≤.'
    }
}

# –ö–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
PROMPTS_CATALOG = {
    '–ì—Ä–∏–º—É–∞—Ä': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üéØ –§–æ–∫—É—Å –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ —à—É–º–∞ –∑–∞ 5-10 –º–∏–Ω—É—Ç',
        '–¥–ª—è_—á–µ–≥–æ': '–ü–æ–º–æ–≥–∞–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —è—Å–Ω–æ—Å—Ç—å —É–º–∞ –∏ –≤—ã–±—Ä–∞—Ç—å 1-3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —à–∞–≥–∞ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è –≤–ø–µ—Ä–µ–¥',
        '–∫–Ω–æ–ø–∫–∞': 'üîÆ –ì—Ä–∏–º—É–∞—Ä',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'self',
        '–¥–µ–º–æ_–∫–ª—é—á': '–≥—Ä–∏–º—É–∞—Ä'
    },
    '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üíº –¢—Ä–µ–Ω–∞–∂—ë—Ä –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ —Å —Ä–∞–∑–±–æ—Ä–æ–º –º–µ—Ç–æ–¥–æ–≤', 
        '–¥–ª—è_—á–µ–≥–æ': '–û—Ç—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –≤ —Ä–µ–∂–∏–º–∞—Ö: —Ç–µ–ª–µ—Ñ–æ–Ω, –ø–æ—á—Ç–∞, –≤—Å—Ç—Ä–µ—á–∏, —Å–µ–º—å—è',
        '–∫–Ω–æ–ø–∫–∞': 'üíº –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'business',
        '–¥–µ–º–æ_–∫–ª—é—á': '–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫'
    },
    '–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üöÄ –û—Ç –∏–¥–µ–∏ –∫ –ø–ª–∞–Ω—É –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é',
        '–¥–ª—è_—á–µ–≥–æ': '–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å —á–µ—Ç–∫–∏–º–∏ —ç—Ç–∞–ø–∞–º–∏, —Å—Ä–æ–∫–∞–∏ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–æ–ª–µ–π',
        '–∫–Ω–æ–ø–∫–∞': 'üìã –ü—Ä–æ–µ–∫—Ç—ã',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'business',
        '–¥–µ–º–æ_–∫–ª—é—á': '–ø—Ä–æ–µ–∫—Ç—ã'
    },
    '–ö–∞—Ä—Ç–∞ –ª–∏—á–Ω–æ—Å—Ç–∏': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üß† –í–∞—à –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –∏ —Ä–æ—Å—Ç',
        '–¥–ª—è_—á–µ–≥–æ': '–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, –∞—Ä—Ö–µ—Ç–∏–ø—ã –∏ —Å–æ–∑–¥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è',
        '–∫–Ω–æ–ø–∫–∞': 'üß© –ú–æ—è –∫–∞—Ä—Ç–∞',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'self',
        '–¥–µ–º–æ_–∫–ª—é—á': '–∫–∞—Ä—Ç–∞ –ª–∏—á–Ω–æ—Å—Ç–∏'
    },
    '–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üìà –ì–ª—É–±–æ–∫–∏–π —Ä–∞–∑–±–æ—Ä —Ç–µ–º –∏ —Ä—ã–Ω–∫–æ–≤',
        '–¥–ª—è_—á–µ–≥–æ': '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤, —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ KPI –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤—ã—Ö–æ–¥–∞ –Ω–∞ —Ä—ã–Ω–æ–∫',
        '–∫–Ω–æ–ø–∫–∞': 'üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'business',
        '–¥–µ–º–æ_–∫–ª—é—á': '—Å—Ç—Ä–∞—Ç–µ–≥–∏—è'
    },
    '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üåç –û–±–∑–æ—Ä –º–∏—Ä–∞ + –ø—Ä–æ–≥–Ω–æ–∑—ã',
        '–¥–ª—è_—á–µ–≥–æ': '–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏, —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–∑–≤–∏—Ç–∏—è –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏',
        '–∫–Ω–æ–ø–∫–∞': 'üìä –î–∞–π–¥–∂–µ—Å—Ç',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'self',
        '–¥–µ–º–æ_–∫–ª—é—á': '–¥–∞–π–¥–∂–µ—Å—Ç'
    },
    '–ó–∞–ø—É—Å–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üõí –û—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∏ –¥–æ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è',
        '–¥–ª—è_—á–µ–≥–æ': '–†–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏, —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–∞ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–æ—Å—Ç–∞ –ø—Ä–æ–¥–∞–∂',
        '–∫–Ω–æ–ø–∫–∞': 'üõçÔ∏è –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'business',
        '–¥–µ–º–æ_–∫–ª—é—á': '–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å'
    },
    '–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üîç –û—Ç –∏—Ç–æ–≥–∞ –∫ –ø—Ä–∏—á–∏–Ω–∞–º —É—Å–ø–µ—Ö–∞',
        '–¥–ª—è_—á–µ–≥–æ': '–†–∞–∑–±–æ—Ä –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏',
        '–∫–Ω–æ–ø–∫–∞': 'üìê –ê–Ω–∞–ª–∏–∑ –∏—Ç–æ–≥–æ–≤',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'business',
        '–¥–µ–º–æ_–∫–ª—é—á': '–∞–Ω–∞–ª–∏–∑ –∏—Ç–æ–≥–æ–≤'
    },
    '–ö–æ–º–ø–∞—Å —Ç–µ–º': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üß≠ –ù–∞–≤–∏–≥–∞—Ç–æ—Ä –≤—ã–±–æ—Ä–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è',
        '–¥–ª—è_—á–µ–≥–æ': '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ—Ç–∏–≤–æ–≤, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ KPI –∏ –≤—ã–±–æ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞',
        '–∫–Ω–æ–ø–∫–∞': 'üß≠ –ö–æ–º–ø–∞—Å —Ç–µ–º',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'self',
        '–¥–µ–º–æ_–∫–ª—é—á': '–∫–æ–º–ø–∞—Å —Ç–µ–º'
    },
    '–ú–∞–∫—Ä–æ-—Å—Ü–µ–Ω–∞—Ä–∏–∏': {
        '–æ–ø–∏—Å–∞–Ω–∏–µ': 'üìä –≠–∫–æ–Ω–æ–º–∏–∫–∞ ‚Üí –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è',
        '–¥–ª—è_—á–µ–≥–æ': '–°—Ü–µ–Ω–∞—Ä–∏–∏ –Ω–∞ 6-36 –º–µ—Å—è—Ü–µ–≤ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π',
        '–∫–Ω–æ–ø–∫–∞': 'üåê –ú–∞–∫—Ä–æ-–∞–Ω–∞–ª–∏–∑',
        '–∫–∞—Ç–µ–≥–æ—Ä–∏—è': 'business',
        '–¥–µ–º–æ_–∫–ª—é—á': '–º–∞–∫—Ä–æ-–∞–Ω–∞–ª–∏–∑'
    }
}

# –ú–∞–ø–ø–∏–Ω–≥ –∫—Ä–∞—Å–∏–≤—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –∫–Ω–æ–ø–æ–∫ –¥–ª—è –¥–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
DEMO_BUTTON_NAMES = {
    '–∞—Ä—Ö–µ—Ç–∏–ø—ã': 'üîÆ –ê—Ä—Ö–µ—Ç–∏–ø—ã',
    '–º–µ—Ç–∞—Ñ–æ—Ä—ã': 'üåå –ú–µ—Ç–∞—Ñ–æ—Ä—ã',
    '—Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ': 'üß† –°–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ',
    '–∫–æ–Ω—Ñ–ª–∏–∫—Ç': '‚ö° –ö–æ–Ω—Ñ–ª–∏–∫—Ç',
    '–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞': 'üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞',
    '–≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è': 'üõ°Ô∏è –í–æ–∑—Ä–∞–∂–µ–Ω–∏—è',
    '—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞': 'üéØ –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞',
    '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ': 'üìä –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ',
    '–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ': '‚ö° –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ',
    '–ø—Ä–æ—Ñ–∏–ª—å': 'üß† –ü—Ä–æ—Ñ–∏–ª—å',
    '—Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã': 'üí™ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã',
    '—Å—Ü–µ–Ω–∞—Ä–∏–∏': 'üìà –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–æ—Å—Ç–∞',
    '–∞–Ω–∞–ª–∏–∑': 'üìà –ê–Ω–∞–ª–∏–∑',
    '–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ': 'üéØ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ',
    '–ø—Ä–æ–≥–Ω–æ–∑': 'üîÆ –ü—Ä–æ–≥–Ω–æ–∑',
    '–æ–±–∑–æ—Ä': 'üåç –û–±–∑–æ—Ä',
    '–ø—Ä–æ–≥–Ω–æ–∑—ã': 'üìä –ü—Ä–æ–≥–Ω–æ–∑—ã',
    '—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏': 'üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏',
    '—ç–∫–æ–Ω–æ–º–∏–∫–∞': 'üõí –≠–∫–æ–Ω–æ–º–∏–∫–∞',
    '–∫–∞—Ä—Ç–æ—á–∫–∞': 'üìã –ö–∞—Ä—Ç–æ—á–∫–∞',
    '–ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ': 'üöÄ –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ',
    '–ø—Ä–∏—á–∏–Ω—ã': 'üîç –ü—Ä–∏—á–∏–Ω—ã',
    '–¥–∞–Ω–Ω—ã–µ': 'üìä –î–∞–Ω–Ω—ã–µ',
    '–æ–±—Ä–∞—Ç–Ω—ã–π –ø–ª–∞–Ω': 'üîÑ –û–±—Ä–∞—Ç–Ω—ã–π –ø–ª–∞–Ω',
    '–º–æ—Ç–∏–≤—ã': 'üß≠ –ú–æ—Ç–∏–≤—ã',
    '–∏—Å—Ö–æ–¥': 'üéØ –ò—Å—Ö–æ–¥',
    '—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç': '‚ö° –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç',
    '–º–µ—Ç—Ä–∏–∫–∏': 'üìä –ú–µ—Ç—Ä–∏–∫–∏',
    '—Å—Ü–µ–Ω–∞—Ä–∏–∏_–º–∞–∫—Ä–æ': 'üåê –°—Ü–µ–Ω–∞—Ä–∏–∏',
    '–¥–µ–π—Å—Ç–≤–∏—è': 'üí° –î–µ–π—Å—Ç–≤–∏—è'
}

class BotState:
    def __init__(self):
        self.user_states = {}

bot_state = BotState()

# –§–£–ù–ö–¶–ò–ò –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê –≠–ö–û–ù–û–ú–ò–ö–ò
def calculate_economy_metrics(data):
    """–†–∞—Å—á–µ—Ç –≤—Å–µ—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫"""
    —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å = data[0]
    —Ü–µ–Ω–∞ = data[1]
    –∫–æ–º–∏—Å—Å–∏—è_–ø—Ä–æ—Ü–µ–Ω—Ç = data[2]
    –ª–æ–≥–∏—Å—Ç–∏–∫–∞_–ø—Ä–æ—Ü–µ–Ω—Ç = data[3]
    acos_–ø—Ä–æ—Ü–µ–Ω—Ç = data[4]
    –Ω–∞–ª–æ–≥_–ø—Ä–æ—Ü–µ–Ω—Ç = data[5]
    
    # –†–∞—Å—á–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
    –≤—ã—Ä—É—á–∫–∞ = —Ü–µ–Ω–∞
    –∫–æ–º–∏—Å—Å–∏—è = –≤—ã—Ä—É—á–∫–∞ * –∫–æ–º–∏—Å—Å–∏—è_–ø—Ä–æ—Ü–µ–Ω—Ç / 100
    –ª–æ–≥–∏—Å—Ç–∏–∫–∞ = –≤—ã—Ä—É—á–∫–∞ * –ª–æ–≥–∏—Å—Ç–∏–∫–∞_–ø—Ä–æ—Ü–µ–Ω—Ç / 100
    cm1 = –≤—ã—Ä—É—á–∫–∞ - —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å - –∫–æ–º–∏—Å—Å–∏—è - –ª–æ–≥–∏—Å—Ç–∏–∫–∞
    —Ä–µ–∫–ª–∞–º–∞ = –≤—ã—Ä—É—á–∫–∞ * acos_–ø—Ä–æ—Ü–µ–Ω—Ç / 100
    cm2 = cm1 - —Ä–µ–∫–ª–∞–º–∞
    –Ω–∞–ª–æ–≥ = –≤—ã—Ä—É—á–∫–∞ * –Ω–∞–ª–æ–≥_–ø—Ä–æ—Ü–µ–Ω—Ç / 100
    —á–∏—Å—Ç–∞—è_–ø—Ä–∏–±—ã–ª—å = cm2 - –Ω–∞–ª–æ–≥
    
    # –†–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
    –Ω–∞—Ü–µ–Ω–∫–∞_–ø—Ä–æ—Ü–µ–Ω—Ç = ((—Ü–µ–Ω–∞ - —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å) / —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å) * 100 if —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å > 0 else 0
    –º–∞—Ä–∂–∞_cm1_–ø—Ä–æ—Ü–µ–Ω—Ç = (cm1 / –≤—ã—Ä—É—á–∫–∞) * 100 if –≤—ã—Ä—É—á–∫–∞ > 0 else 0
    –º–∞—Ä–∂–∞_cm2_–ø—Ä–æ—Ü–µ–Ω—Ç = (cm2 / –≤—ã—Ä—É—á–∫–∞) * 100 if –≤—ã—Ä—É—á–∫–∞ > 0 else 0
    —á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞_–ø—Ä–æ—Ü–µ–Ω—Ç = (—á–∏—Å—Ç–∞—è_–ø—Ä–∏–±—ã–ª—å / –≤—ã—Ä—É—á–∫–∞) * 100 if –≤—ã—Ä—É—á–∫–∞ > 0 else 0
    
    return {
        '–≤—ã—Ä—É—á–∫–∞': –≤—ã—Ä—É—á–∫–∞,
        '—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å': —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å,
        '–∫–æ–º–∏—Å—Å–∏—è': –∫–æ–º–∏—Å—Å–∏—è,
        '–∫–æ–º–∏—Å—Å–∏—è_%': –∫–æ–º–∏—Å—Å–∏—è_–ø—Ä–æ—Ü–µ–Ω—Ç,
        '–ª–æ–≥–∏—Å—Ç–∏–∫–∞': –ª–æ–≥–∏—Å—Ç–∏–∫–∞,
        '–ª–æ–≥–∏—Å—Ç–∏–∫–∞_%': –ª–æ–≥–∏—Å—Ç–∏–∫–∞_–ø—Ä–æ—Ü–µ–Ω—Ç,
        'cm1': cm1,
        '–º–∞—Ä–∂–∞_cm1_%': –º–∞—Ä–∂–∞_cm1_–ø—Ä–æ—Ü–µ–Ω—Ç,
        '—Ä–µ–∫–ª–∞–º–∞': —Ä–µ–∫–ª–∞–º–∞,
        'acos_%': acos_–ø—Ä–æ—Ü–µ–Ω—Ç,
        'cm2': cm2,
        '–º–∞—Ä–∂–∞_cm2_%': –º–∞—Ä–∂–∞_cm2_–ø—Ä–æ—Ü–µ–Ω—Ç,
        '–Ω–∞–ª–æ–≥': –Ω–∞–ª–æ–≥,
        '–Ω–∞–ª–æ–≥_%': –Ω–∞–ª–æ–≥_–ø—Ä–æ—Ü–µ–Ω—Ç,
        '—á–∏—Å—Ç–∞—è_–ø—Ä–∏–±—ã–ª—å': —á–∏—Å—Ç–∞—è_–ø—Ä–∏–±—ã–ª—å,
        '—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞_%': —á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞_–ø—Ä–æ—Ü–µ–Ω—Ç,
        '–Ω–∞—Ü–µ–Ω–∫–∞_%': –Ω–∞—Ü–µ–Ω–∫–∞_–ø—Ä–æ—Ü–µ–Ω—Ç
    }

def generate_recommendations(metrics):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫"""
    recommendations = []
    
    # –ê–Ω–∞–ª–∏–∑ –Ω–∞—Ü–µ–Ω–∫–∏
    if metrics['–Ω–∞—Ü–µ–Ω–∫–∞_%'] > BENCHMARKS['–Ω–∞—Ü–µ–Ω–∫–∞']['–≤—ã—Å–æ–∫–∞—è']:
        recommendations.append("üöÄ –û—Ç–ª–∏—á–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞! –¢–æ–≤–∞—Ä –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ø—Ä–∏–±—ã–ª–∏")
    elif metrics['–Ω–∞—Ü–µ–Ω–∫–∞_%'] < BENCHMARKS['–Ω–∞—Ü–µ–Ω–∫–∞']['–Ω–∏–∑–∫–∞—è']:
        recommendations.append("üìà –ù–∏–∑–∫–∞—è –Ω–∞—Ü–µ–Ω–∫–∞. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏–ª–∏ –ø–æ–∏—Å–∫ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —Å –ª—É—á—à–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏")
    
    # –ê–Ω–∞–ª–∏–∑ –∫–æ–º–∏—Å—Å–∏–∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
    if metrics['–∫–æ–º–∏—Å—Å–∏—è_%'] > BENCHMARKS['–∫–æ–º–∏—Å—Å–∏—è_mp']['–≤—ã—Å–æ–∫–∞—è']:
        recommendations.append("üìä –ö–æ–º–∏—Å—Å–∏—è –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã —Å –º–µ–Ω—å—à–µ–π –∫–æ–º–∏—Å—Å–∏–µ–π")
    elif metrics['–∫–æ–º–∏—Å—Å–∏—è_%'] < BENCHMARKS['–∫–æ–º–∏—Å—Å–∏—è_mp']['–Ω–∏–∑–∫–∞—è']:
        recommendations.append("üí∞ –ù–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è - —Ö–æ—Ä–æ—à–∏–µ —É—Å–ª–æ–≤–∏—è!")
    
    # –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–∏—Å—Ç–∏–∫–∏
    if metrics['–ª–æ–≥–∏—Å—Ç–∏–∫–∞_%'] > BENCHMARKS['–ª–æ–≥–∏—Å—Ç–∏–∫–∞']['–≤—ã—Å–æ–∫–∞—è']:
        recommendations.append("üöö –õ–æ–≥–∏—Å—Ç–∏–∫–∞ –¥–æ—Ä–æ–≥–æ–≤–∞—Ç–∞. –ò—â–∏—Ç–µ —Å–ø–æ—Å–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–ª–∏ —É–ø–∞–∫–æ–≤–∫–∏")
    elif metrics['–ª–æ–≥–∏—Å—Ç–∏–∫–∞_%'] < BENCHMARKS['–ª–æ–≥–∏—Å—Ç–∏–∫–∞']['–Ω–∏–∑–∫–∞—è']:
        recommendations.append("üì¶ –õ–æ–≥–∏—Å—Ç–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞!")
    
    # –ê–Ω–∞–ª–∏–∑ ACOS
    if metrics['acos_%'] > BENCHMARKS['acos']['–≤—ã—Å–æ–∫–∏–π']:
        recommendations.append("üì¢ –í—ã—Å–æ–∫–∏–π ACOS. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –∫–æ–≥–æ—Ä—Ç—ã")
    elif metrics['acos_%'] < BENCHMARKS['acos']['–Ω–∏–∑–∫–∏–π']:
        recommendations.append("üéØ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞!")
    
    # –ê–Ω–∞–ª–∏–∑ —á–∏—Å—Ç–æ–π –º–∞—Ä–∂–∏
    if metrics['—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞_%'] > BENCHMARKS['—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞']['–≤—ã—Å–æ–∫–∞—è']:
        recommendations.append("‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å! –¢–æ–≤–∞—Ä –≥–æ—Ç–æ–≤ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é")
    elif metrics['—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞_%'] < BENCHMARKS['—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞']['–Ω–∏–∑–∫–∞—è']:
        recommendations.append("üí∏ –ù–∏–∑–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏–ª–∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –∑–∞–∫—É–ø–æ—á–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏")
    
    return recommendations if recommendations else ["üìä –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ –Ω–æ—Ä–º–µ. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!"]

async def calculate_and_show_results(update: Update, context: CallbackContext):
    """–†–∞—Å—á–µ—Ç –∏ –ø–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞"""
    data = [context.user_data['calculator_data'][i] for i in range(6)]
    metrics = calculate_economy_metrics(data)
    recommendations = generate_recommendations(metrics)
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—ã–≤–æ–¥
    report = f"""üìä **–§–ò–ù–ê–ù–°–û–í–´–ô –ê–ù–ê–õ–ò–ó –¢–û–í–ê–†–ê**

üí∞ **–í–´–†–£–ß–ö–ê –ò –ó–ê–¢–†–ê–¢–´:**
‚Ä¢ –í—ã—Ä—É—á–∫–∞: {metrics['–≤—ã—Ä—É—á–∫–∞']:.1f} ‚ÇΩ
‚Ä¢ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å: {metrics['—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å']:.1f} ‚ÇΩ
‚Ä¢ –ö–æ–º–∏—Å—Å–∏—è MP: {metrics['–∫–æ–º–∏—Å—Å–∏—è']:.1f} ‚ÇΩ ({metrics['–∫–æ–º–∏—Å—Å–∏—è_%']:.1f}%)
‚Ä¢ –õ–æ–≥–∏—Å—Ç–∏–∫–∞ FBS: {metrics['–ª–æ–≥–∏—Å—Ç–∏–∫–∞']:.1f} ‚ÇΩ ({metrics['–ª–æ–≥–∏—Å—Ç–∏–∫–∞_%']:.1f}%)
‚Ä¢ –†–µ–∫–ª–∞–º–∞ (ACOS): {metrics['—Ä–µ–∫–ª–∞–º–∞']:.1f} ‚ÇΩ ({metrics['acos_%']:.1f}%)
‚Ä¢ –ù–∞–ª–æ–≥ –£–°–ù: {metrics['–Ω–∞–ª–æ–≥']:.1f} ‚ÇΩ ({metrics['–Ω–∞–ª–æ–≥_%']:.1f}%)

üéØ **–£–†–û–í–ù–ò –ü–†–ò–ë–´–õ–ò:**
‚Ä¢ CM1 (–¥–æ —Ä–µ–∫–ª–∞–º—ã): {metrics['cm1']:.1f} ‚ÇΩ ({metrics['–º–∞—Ä–∂–∞_cm1_%']:.1f}%)
‚Ä¢ CM2 (–ø–æ—Å–ª–µ —Ä–µ–∫–ª–∞–º—ã): {metrics['cm2']:.1f} ‚ÇΩ ({metrics['–º–∞—Ä–∂–∞_cm2_%']:.1f}%)
‚Ä¢ –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: {metrics['—á–∏—Å—Ç–∞—è_–ø—Ä–∏–±—ã–ª—å']:.1f} ‚ÇΩ ({metrics['—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞_%']:.1f}%)

üìà **–ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò:**
‚Ä¢ –ù–∞—Ü–µ–Ω–∫–∞: {metrics['–Ω–∞—Ü–µ–Ω–∫–∞_%']:.1f}% {'üöÄ' if metrics['–Ω–∞—Ü–µ–Ω–∫–∞_%'] > 300 else '‚úÖ' if metrics['–Ω–∞—Ü–µ–Ω–∫–∞_%'] > 200 else 'üìä'}
‚Ä¢ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å: {metrics['—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞_%']:.1f}% {'‚úÖ' if metrics['—á–∏—Å—Ç–∞—è_–º–∞—Ä–∂–∞_%'] > 30 else 'üìä'}

üí° **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:**
"""
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    for rec in recommendations:
        report += f"‚Ä¢ {rec}\n"
    
    keyboard = [
        [KeyboardButton("üîÑ –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç")],
        [KeyboardButton("üîô –ù–∞–∑–∞–¥")]
    ]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    await update.message.reply_text(report, reply_markup=reply_markup)

async def start_economy_calculator(update: Update, context: CallbackContext) -> None:
    """–ù–∞—á–∞–ª–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —ç–∫–æ–Ω–æ–º–∏–∫–∏"""
    bot_state.user_states[update.message.from_user.id] = 'ECONOMY_CALCULATOR'
    context.user_data['calculator_step'] = 0
    context.user_data['calculator_data'] = {}
    
    await update.message.reply_text(
        "üõçÔ∏è **–†–ê–°–ß–ï–¢ –≠–ö–û–ù–û–ú–ò–ö–ò –ú–ê–†–ö–ï–¢–ü–õ–ï–ô–°–ê**\n\n"
        "–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ —Ç–æ–≤–∞—Ä–∞:\n\n"
        + CALCULATOR_STEPS[0]
    )

async def handle_economy_calculator(update: Update, context: CallbackContext) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—à–∏–±–æ–∫"""
    user = update.message.from_user
    text = update.message.text
    step = context.user_data.get('calculator_step', 0)
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    if text == "üîô –ù–∞–∑–∞–¥":
        if step == 0:
            # –í–æ–∑–≤—Ä–∞—Ç –∫ –¥–µ–º–æ-–º–µ–Ω—é –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
            bot_state.user_states[user.id] = 'DEMO_MENU'
            await show_demo_scenarios(update, context, '–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å')
        else:
            # –®–∞–≥ –Ω–∞–∑–∞–¥ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ
            context.user_data['calculator_step'] = step - 1
            await update.message.reply_text(CALCULATOR_STEPS[step - 1])
        return
    
    if text == "üîÑ –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç":
        context.user_data['calculator_step'] = 0
        context.user_data['calculator_data'] = {}
        await start_economy_calculator(update, context)
        return
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
    try:
        value = float(text)
        if value < 0:
            await update.message.reply_text("‚ùå –ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑:")
            return
            
        context.user_data['calculator_data'][step] = value
        context.user_data['calculator_step'] = step + 1
        
        if step + 1 < len(CALCULATOR_STEPS):
            await update.message.reply_text(CALCULATOR_STEPS[step + 1])
        else:
            await calculate_and_show_results(update, context)
            
    except ValueError:
        await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ:")

# –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ë–û–¢–ê (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
async def start(update: Update, context: CallbackContext) -> None:
    user = update.message.from_user
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.first_name} –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É")
    
    bot_state.user_states[user.id] = 'MAIN_MENU'
    
    keyboard = [
        [KeyboardButton("üß† –î–õ–Ø –°–ï–ë–Ø"), KeyboardButton("üöÄ –î–õ–Ø –î–ï–õ–ê")],
        [KeyboardButton("üìö –í–°–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´"), KeyboardButton("‚ÑπÔ∏è –û –ë–û–¢–ï")]
    ]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    await update.message.reply_text(
        "üõ†Ô∏è **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è!**\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:",
        reply_markup=reply_markup
    )

async def handle_message(update: Update, context: CallbackContext) -> None:
    user = update.message.from_user
    text = update.message.text
    current_state = bot_state.user_states.get(user.id, 'MAIN_MENU')
    
    if current_state == 'MAIN_MENU':
        await handle_main_menu(update, context)
    elif current_state == 'CATEGORY_MENU':
        await handle_category_menu(update, context)
    elif current_state == 'TOOL_MENU':
        await handle_tool_menu(update, context)
    elif current_state == 'DEMO_MENU':
        await handle_demo_menu(update, context)
    elif current_state == 'ECONOMY_CALCULATOR':  # ‚Üê –ù–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï
        await handle_economy_calculator(update, context)

async def handle_main_menu(update: Update, context: CallbackContext) -> None:
    user = update.message.from_user
    text = update.message.text
    
    if text == "üß† –î–õ–Ø –°–ï–ë–Ø":
        bot_state.user_states[user.id] = 'CATEGORY_MENU'
        context.user_data['current_category'] = 'self'
        await show_self_category(update, context)
        
    elif text == "üöÄ –î–õ–Ø –î–ï–õ–ê":
        bot_state.user_states[user.id] = 'CATEGORY_MENU'
        context.user_data['current_category'] = 'business'
        await show_business_category(update, context)
        
    elif text == "üìö –í–°–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´":
        bot_state.user_states[user.id] = 'CATEGORY_MENU'
        context.user_data['current_category'] = 'all'
        await show_all_tools(update, context)
        
    elif text == "‚ÑπÔ∏è –û –ë–û–¢–ï":
        await update.message.reply_text(
            "ü§ñ **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞**\n\n"
            "üîÆ **–ì—Ä–∏–º—É–∞—Ä** - —Ñ–æ–∫—É—Å –∏ —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –º–µ—Ç–∞—Ñ–æ—Ä—ã\n"
            "üíº **–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫** - –Ω–∞–≤—ã–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤\n"
            "üìã **–ü—Ä–æ–µ–∫—Ç—ã** - –æ—Ç –∏–¥–µ–∏ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é\n"
            "üß© **–ú–æ—è –∫–∞—Ä—Ç–∞** - –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –∏ —Ä–æ—Å—Ç\n"
            "üéØ **–°—Ç—Ä–∞—Ç–µ–≥–∏—è** - –∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–æ–≤ –∏ —Ç—Ä–µ–Ω–¥–æ–≤\n"
            "üìä **–î–∞–π–¥–∂–µ—Å—Ç** - –æ–±–∑–æ—Ä—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã\n"
            "üõçÔ∏è **–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å** - –∑–∞–ø—É—Å–∫ –∏ —Ä–æ—Å—Ç –ø—Ä–æ–¥–∞–∂\n"
            "üìê **–ê–Ω–∞–ª–∏–∑ –∏—Ç–æ–≥–æ–≤** - —Ä–∞–∑–±–æ—Ä —É—Å–ø–µ—Ö–æ–≤\n"
            "üß≠ **–ö–æ–º–ø–∞—Å —Ç–µ–º** - –≤—ã–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n"
            "üåê **–ú–∞–∫—Ä–æ-–∞–Ω–∞–ª–∏–∑** - —ç–∫–æ–Ω–æ–º–∏–∫–∞ –∏ —Ä–µ—à–µ–Ω–∏—è\n\n"
            "–ö–∞–∂–¥—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–º–µ–µ—Ç –¥–µ–º–æ-–≤–µ—Ä—Å–∏—é –∏ –≥–æ—Ç–æ–≤ –∫ –ø–ª–∞—Ç–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—É!"
        )
    else:
        await update.message.reply_text("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ –º–µ–Ω—é:")

async def show_self_category(update: Update, context: CallbackContext) -> None:
    keyboard = [
        [KeyboardButton("üîÆ –ì—Ä–∏–º—É–∞—Ä"), KeyboardButton("üß© –ú–æ—è –∫–∞—Ä—Ç–∞")],
        [KeyboardButton("üß≠ –ö–æ–º–ø–∞—Å —Ç–µ–º"), KeyboardButton("üìä –î–∞–π–¥–∂–µ—Å—Ç")],
        [KeyboardButton("üîô –ù–∞–∑–∞–¥")]
    ]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    await update.message.reply_text(
        "üß† **–î–õ–Ø –°–ï–ë–Ø**\n\n"
        "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ª–∏—á–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—è:",
        reply_markup=reply_markup
    )

async def show_business_category(update: Update, context: CallbackContext) -> None:
    keyboard = [
        [KeyboardButton("üíº –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫"), KeyboardButton("üìã –ü—Ä–æ–µ–∫—Ç—ã")],
        [KeyboardButton("üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è"), KeyboardButton("üõçÔ∏è –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å")],
        [KeyboardButton("üìê –ê–Ω–∞–ª–∏–∑ –∏—Ç–æ–≥–æ–≤"), KeyboardButton("üåê –ú–∞–∫—Ä–æ-–∞–Ω–∞–ª–∏–∑")],
        [KeyboardButton("üîô –ù–∞–∑–∞–¥")]
    ]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    await update.message.reply_text(
        "üöÄ **–î–õ–Ø –î–ï–õ–ê**\n\n"
        "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ –±–∏–∑–Ω–µ—Å–∞:",
        reply_markup=reply_markup
    )

async def show_all_tools(update: Update, context: CallbackContext) -> None:
    keyboard = [
        [KeyboardButton("üîÆ –ì—Ä–∏–º—É–∞—Ä"), KeyboardButton("üíº –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫")],
        [KeyboardButton("üìã –ü—Ä–æ–µ–∫—Ç—ã"), KeyboardButton("üß© –ú–æ—è –∫–∞—Ä—Ç–∞")],
        [KeyboardButton("üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è"), KeyboardButton("üìä –î–∞–π–¥–∂–µ—Å—Ç")],
        [KeyboardButton("üõçÔ∏è –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å"), KeyboardButton("üìê –ê–Ω–∞–ª–∏–∑ –∏—Ç–æ–≥–æ–≤")],
        [KeyboardButton("üß≠ –ö–æ–º–ø–∞—Å —Ç–µ–º"), KeyboardButton("üåê –ú–∞–∫—Ä–æ-–∞–Ω–∞–ª–∏–∑")],
        [KeyboardButton("üîô –ù–∞–∑–∞–¥")]
    ]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    await update.message.reply_text(
        "üìö **–í–°–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´**\n\n"
        "–ü–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π:",
        reply_markup=reply_markup
    )

async def handle_category_menu(update: Update, context: CallbackContext) -> None:
    user = update.message.from_user
    text = update.message.text
    
    if text == "üîô –ù–∞–∑–∞–¥":
        bot_state.user_states[user.id] = 'MAIN_MENU'
        await start(update, context)
        return
    
    # –ú–∞–ø–ø–∏–Ω–≥ –∫–Ω–æ–ø–æ–∫ –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
    tool_mapping = {
        'üîÆ –ì—Ä–∏–º—É–∞—Ä': '–ì—Ä–∏–º—É–∞—Ä',
        'üíº –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫': '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫',
        'üìã –ü—Ä–æ–µ–∫—Ç—ã': '–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞',
        'üß© –ú–æ—è –∫–∞—Ä—Ç–∞': '–ö–∞—Ä—Ç–∞ –ª–∏—á–Ω–æ—Å—Ç–∏',
        'üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è': '–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑',
        'üìä –î–∞–π–¥–∂–µ—Å—Ç': '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç',
        'üõçÔ∏è –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å': '–ó–∞–ø—É—Å–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ',
        'üìê –ê–Ω–∞–ª–∏–∑ –∏—Ç–æ–≥–æ–≤': '–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
        'üß≠ –ö–æ–º–ø–∞—Å —Ç–µ–º': '–ö–æ–º–ø–∞—Å —Ç–µ–º',
        'üåê –ú–∞–∫—Ä–æ-–∞–Ω–∞–ª–∏–∑': '–ú–∞–∫—Ä–æ-—Å—Ü–µ–Ω–∞—Ä–∏–∏'
    }
    
    if text in tool_mapping:
        tool_name = tool_mapping[text]
        bot_state.user_states[user.id] = 'TOOL_MENU'
        context.user_data['current_tool'] = tool_name
        await show_tool_description(update, context, tool_name)
    else:
        await update.message.reply_text("–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–∑ –º–µ–Ω—é:")

async def show_tool_description(update: Update, context: CallbackContext, tool_name: str) -> None:
    tool_data = PROMPTS_CATALOG[tool_name]
    
    # –î–ª—è –í–°–ï–• –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–µ–º–æ/–ø–ª–∞—Ç–Ω–æ
    keyboard = [
        [KeyboardButton("üÜì –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å"), KeyboardButton("üí≥ –ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø")],
        [KeyboardButton("üîô –ù–∞–∑–∞–¥")]
    ]
    
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    await update.message.reply_text(
        f"**{tool_data['–∫–Ω–æ–ø–∫–∞']}**\n\n"
        f"{tool_data['–æ–ø–∏—Å–∞–Ω–∏–µ']}\n\n"
        f"üéØ {tool_data['–¥–ª—è_—á–µ–≥–æ']}",
        reply_markup=reply_markup
    )

async def handle_tool_menu(update: Update, context: CallbackContext) -> None:
    user = update.message.from_user
    text = update.message.text
    tool_name = context.user_data.get('current_tool', 'unknown')
    category = context.user_data.get('current_category', 'all')
    
    if text == "üîô –ù–∞–∑–∞–¥":
        bot_state.user_states[user.id] = 'CATEGORY_MENU'
        if category == 'self':
            await show_self_category(update, context)
        elif category == 'business':
            await show_business_category(update, context)
        else:
            await show_all_tools(update, context)
        return
    
    if text == "üÜì –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å":
        # –î–ª—è –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –µ—Å—Ç—å –¥–µ–º–æ
        if tool_name in PROMPTS_CATALOG:
            bot_state.user_states[user.id] = 'DEMO_MENU'
            demo_key = PROMPTS_CATALOG[tool_name]['–¥–µ–º–æ_–∫–ª—é—á']
            context.user_data['current_product'] = demo_key
            context.user_data['current_tool_for_demo'] = tool_name
            await show_demo_scenarios(update, context, demo_key)
    
    elif text == "üí≥ –ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø":
        await update.message.reply_text(
            "üöÄ **–ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä–æ–µ—Ç:**\n\n"
            "‚Ä¢ –ñ–∏–≤–æ–µ –æ–±—â–µ–Ω–∏–µ —Å AI-–ø–æ–º–æ—â–Ω–∏–∫–æ–º\n"
            "‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã\n" 
            "‚Ä¢ –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞\n"
            "‚Ä¢ –î–æ—Å—Ç—É–ø –Ω–∞ 5 –¥–Ω–µ–π\n\n"
            "–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø!"
        )

async def show_demo_scenarios(update: Update, context: CallbackContext, product: str) -> None:
    scenarios = DEMO_SCENARIOS[product]
    
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
    keyboard = []
    for scenario_name in scenarios.keys():
        button_text = DEMO_BUTTON_NAMES.get(scenario_name, scenario_name)
        keyboard.append([KeyboardButton(button_text)])
    
    keyboard.append([KeyboardButton("üîô –ù–∞–∑–∞–¥")])
    
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    await update.message.reply_text(
        "–í—ã–±–µ—Ä–∏—Ç–µ –∞—Å–ø–µ–∫—Ç –¥–ª—è –¥–µ–º–æ-–∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞:",
        reply_markup=reply_markup
    )

async def handle_demo_menu(update: Update, context: CallbackContext) -> None:
    user = update.message.from_user
    text = update.message.text
    product = context.user_data.get('current_product', 'unknown')
    tool_name = context.user_data.get('current_tool_for_demo', 'unknown')
    
    if text == "üîô –ù–∞–∑–∞–¥":
        bot_state.user_states[user.id] = 'TOOL_MENU'
        await show_tool_description(update, context, tool_name)
        return
    
    # –û–±—Ä–∞—Ç–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
    reverse_button_mapping = {v: k for k, v in DEMO_BUTTON_NAMES.items()}
    scenario_key = reverse_button_mapping.get(text)
    
    # –û–°–û–ë–´–ô –°–õ–£–ß–ê–ô –î–õ–Ø –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê –≠–ö–û–ù–û–ú–ò–ö–ò
    if scenario_key and scenario_key in DEMO_SCENARIOS[product]:
        if product == '–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å' and scenario_key == '—ç–∫–æ–Ω–æ–º–∏–∫–∞':
            await start_economy_calculator(update, context)
        else:
            demo_answer = DEMO_SCENARIOS[product][scenario_key]
            await update.message.reply_text(demo_answer)
            
            keyboard = [
                [KeyboardButton("üéØ –î—Ä—É–≥–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π")],
                [KeyboardButton("üîô –í –º–µ–Ω—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞")]
            ]
            reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
            await update.message.reply_text("–ß—Ç–æ –¥–∞–ª—å—à–µ?", reply_markup=reply_markup)
    
    elif text == "üéØ –î—Ä—É–≥–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π":
        await show_demo_scenarios(update, context, product)
        
    elif text == "üîô –í –º–µ–Ω—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞":
        bot_state.user_states[user.id] = 'TOOL_MENU'
        await show_tool_description(update, context, tool_name)
        
    else:
        await update.message.reply_text("–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ –º–µ–Ω—é:")

def main():
    application = Application.builder().token(TOKEN).build()
    
    application.add_handler(CommandHandler("start", start))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º —ç–∫–æ–Ω–æ–º–∏–∫–∏!")
    application.run_polling()

if __name__ == '__main__':
    main()
